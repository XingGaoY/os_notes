# 页面置换算法概念
- 功能
出现缺页异常，调入新页面时内存已满时，置换算法选择被置换的物理页面
- 目标
	- 减少调入调出次数
	- 把未来不再访问或短期不访问的页面调出
- 页面锁定
必须常驻内存
	- 操作系统的关键部分
	- 要求响应速度的代码和数据
	- 实现：页表中的锁定标志位
- 评价方法
	- 模拟行为，记录却也次数
	- 更少的缺页，更好的性能
- 分类
	- 局部置换算法：选择范围仅限当前进程占用的物理页面
		- 最优算法、先进先出算法、最近最久未使用算法
		- 时钟算法、最不常用算法
	- 全局置换算法：置换范围是全部可换出的物理页面
		- 工作集算法、缺页率算法

# 最优算法、先进先出算法和最近最久未使用算法
- 最优算法（OPT）
置换在未来最长不访问的页面
	- 实现：缺页时，计算内存中每个逻辑页面的下一次访问时间，选择最大的页
	- 理想情况但是无法实现
	- 但是可以作为评价依据：模拟器上运行，记录访问情况，第二次使用最优置换算法
- 先进先出算法（FIFO）
选择在内存驻留时间最长的页面置换
	- 实现：维护一个记录所有内存的逻辑页面链表，链表自然按照时间排序，链首最长，链尾最短。置换时，选择链首置换，新页面插入链尾
	- 特征：实现简单；性能较差；Belady现象；很少单独使用；
- 最近最久未使用算法（LRU）
选择最长时间没有被引用的页面进行置换
	- 实现：记录上一次访问时间，选择上一次到当前时间最长未被使用的页面
	- 特征：太复杂，很难实现
	- 页面链表：按照最近一次访问的时间排序。访问时，找到相应页面，移动到链表头。缺页时，置换链表尾的页面
	- 活动页面栈：需要置换时弹出栈底。无缺页时，同样需要遍历，抽出访问的页面，移动到栈顶

# 时钟置换算法和最不常用算法
- 时钟置换算法
	- 思路：仅对页面的访问情况进行大致统计
	- 数据结构：
		- 页表项中增加访问位
		- 页面组织成环形链表
		- 指针指向最先调入的页面
	- 算法：
		- 访问页面时，记录访问情况，一开始装入时，访问位为0。访问后修改为1。
		- 缺页时，从指针处开始顺序查找未被访问的页面，访问位为0，则置换，如果是1，则清零，并指向下一个
	- 改进的时钟算法：增加修改位，如果修改过，则指针指过时，进行写入到外存的操作，同时清零修改位。
- 最不常用算法
	- 思路：缺页时，置换访问次数最少的页面
	- 实现：
		- 每个页增加访问计数
		- 访问页面时，访问计数加1
		- 缺页时，置换技术最小的页面
		- 同时计数不断减少，避免某些页面不会被替换（开销大）

# BELADY现象和局部置换算法比较
- Belady现象
随着分配物理页面增加，缺页次数反而增加
	- 原因：
		- FIFO算法的置换特征和进程访问内存的动态特征矛盾
		- 被置换出去的页面不一定是近期不会访问的
- 证明？？
- LRU FIFO比较
	- LRU根据页面最近访问时间排序，动态调整顺序，性能好，开销大
	- FIFO根据页面进入内存的时间排序，页面进入时间不变，开销小，belady现象
	- 时钟：不再调整顺序，仅仅标记；缺页时再进行调整
	- 对于被访问过的页面，时钟的信息多于FIFO，少于LRU

# 工作集置换算法
- 思路：给进程分配可变数目的物理页面
- 问题：
	- 进程在不同阶段的内存需求不同
	- 分配的内存在不同阶段有变化
- CPU利用率和并发进程数的关系
	- 进程数量太多会破坏局部性，导致性能下降（抖动）
- 工作集
一个进程当前使用的逻辑页面集合W(t, \omiga)
	- t当前执行时刻
	- \omiga工作集窗口，一个定长的页面访问时间窗口
	- W指当前时刻，窗口中所有的页面集合
- 变化规律
	- 逐渐增加，达到稳定的工作集
	- 局部性区域大致稳定时，工作集大小也大致稳定
- 常驻集
当前时刻进程实际驻留在内存中的页面集合
	- 工作集是固有性质
	- 常驻集取决于分配的物理页面大小
	- 如果常驻集包含工作集，缺页较少
	- 如果工作集发生剧烈变动时，缺页较多
	- 如果常驻集达到一定大小，增大常驻集对于缺页影响不大
- 实现思路：换出不在工作集中的页面
- 方法
	- 访存链表，维护窗口内的访存页面链表
	- 访存时，换出窗口外的页面；缺页时，换出页面；

# 缺页率置换算法
- 缺页率
缺页次数/内存访问次数 \approx 缺页平均时间间隔的倒数
	- 影响因素
		- 页面置换算法
		- 分配的物理页面数目
		- 页面大小
		- 程序编写方法

缺页率和分配物理页面数量相关，通过设定好上下阈值，缺页时计算两次缺页的间隔，如果差值大于阈值，则置换所有未被引用的页。如果小于则增加页面
（缺少减少页面的介绍，估计是低于另一个阈值则减少页面数）

# 抖动和负载控制
- 抖动
	- 物理页面太少，不能包含工作集
	- 造成大量缺页，频繁置换
	- 进程运行速度变慢
	- 原因：内存中的进程数目过多，需要在并发水平和缺页率达到平衡
- 负载控制
控制并发进程数进行系统负载控制
	- 控制极限：平均缺页间隔 = 缺页异常处理时间
